#!/usr/bin/env node
var w=Object.create;var u=Object.defineProperty;var F=Object.getOwnPropertyDescriptor;var N=Object.getOwnPropertyNames;var x=Object.getPrototypeOf,E=Object.prototype.hasOwnProperty;var T=e=>u(e,"__esModule",{value:!0});var $=(e,t,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of N(t))!E.call(e,n)&&n!=="default"&&u(e,n,{get:()=>t[n],enumerable:!(o=F(t,n))||o.enumerable});return e},a=e=>$(T(u(e!=null?w(x(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var g=(e,t,o)=>new Promise((n,i)=>{var l=c=>{try{m(o.next(c))}catch(d){i(d)}},s=c=>{try{m(o.throw(c))}catch(d){i(d)}},m=c=>c.done?n(c.value):Promise.resolve(c.value).then(l,s);m((o=o.apply(e,t)).next())});var h=a(require("inquirer")),v=a(require("ora")),p=a(require("fs")),f=a(require("child_process")),k=a(require("download-git-repo")),y=a(require("chalk"));const r=(0,v.default)("\u4E0B\u8F7D\u6A21\u677F\u4E2D, \u8BF7\u7A0D\u540E..."),K=[{name:"vue3-vite2-ts-template \uFF08ant-design-vue\uFF09\u6A21\u677F\u6587\u6863: https://github.com/seho-code-life/project_template/tree/vue3-vite2-ts-template(release)",value:"seho-code-life/project_template#vue3-vite2-ts-template(release)"},{name:"node-command-ts-template                 \u6A21\u677F\u6587\u6863: https://github.com/seho-code-life/project_template/tree/node-command-cli",value:"seho-code-life/project_template#node-command-cli"}],j=[{name:"editorconfig (\u7EDF\u4E00IDE\u914D\u7F6E)",value:"editor",checked:!0},{name:"husky & lint-staged git\u63D0\u4EA4\u94A9\u5B50",value:"commitHook",checked:!0},{name:"eslint (\u5982\u679C\u5DF2\u9009\u62E9\uFF0C\u90A3\u4E48git\u63D0\u4EA4\u4E4B\u524D\u5C06\u4F1A\u81EA\u52A8eslint)",value:"eslint",checked:!0},{name:"prettierr (\u5982\u679C\u5DF2\u9009\u62E9\uFF0C\u90A3\u4E48git\u63D0\u4EA4\u4E4B\u524D\u5C06\u4F1A\u81EA\u52A8prettierr)",value:"prettierr",checked:!0},{name:"vscode\u76F8\u5173\u914D\u7F6E (setting + code-snippets)",value:"vscode",checked:!1}],_={editor:e=>{},commitHook:e=>{},eslint:e=>{},prettierr:e=>{},vscode:e=>{(0,f.exec)("rm -rf .vscode",{cwd:e.path})}},b=e=>{const{checkedfunctions:t}=e;return new Promise((o,n)=>{const l=j.map(s=>s.value).filter(s=>!t.includes(s));try{l.map(s=>_[s](e))}catch(s){n(`\u5904\u7406\u7528\u6237\u9009\u62E9\u7684\u529F\u80FD\u65F6\u51FA\u73B0\u4E86\u9519\u8BEF: ${s}; \u8BF7\u524D\u5F80 https://github.com/seho-code-life/project_tool/issues/new \u62A5\u544A\u6B64\u9519\u8BEF; \u4F46\u662F\u8FD9\u4E0D\u5F71\u54CD\u4F60\u4F7F\u7528\u6B64\u6A21\u677F\uFF0C\u60A8\u53EF\u4EE5\u81EA\u884C\u5220\u51CF\u529F\u80FD`)}o()})},S=e=>{const{projectName:t}=e;r.text="\u6B63\u5728\u5B89\u88C5\u4F9D\u8D56\uFF0C\u5982\u679C\u60A8\u7684\u7F51\u7EDC\u60C5\u51B5\u8F83\u5DEE\uFF0C\u8FD9\u53EF\u80FD\u662F\u4E00\u676F\u8336\u7684\u529F\u592B",(0,f.exec)(`cd ${t} && npm i`,(o,n,i)=>{if(o){console.error(`exec error: ${o}`);return}else n?(r.text=`\u5B89\u88C5\u6210\u529F, \u8FDB\u5165${t}\u5F00\u59CB\u64B8\u7801\uFF5E`,r.succeed()):(r.text="\u81EA\u52A8\u5B89\u88C5\u5931\u8D25, \u8BF7\u67E5\u770B\u9519\u8BEF\uFF0C\u4E14\u4E4B\u540E\u81EA\u884C\u5B89\u88C5\u4F9D\u8D56\uFF5E",r.fail(),console.error(i))})},q=e=>{const{projectName:t,functions:o}=e,n=`${process.cwd()}/${t}`;p.default.readFile(`${n}/package.json`,(i,l)=>g(void 0,null,function*(){if(i)throw i;const s=JSON.parse(l.toString());s.name=t;try{yield b({checkedfunctions:o,package:s,path:n})}catch(c){r.text=`${c}`,r.fail()}const m=JSON.stringify(s,null,4);p.default.writeFile(`${n}/package.json`,m,function(c){if(c)throw c}),r.text="\u4E0B\u8F7D\u5B8C\u6210, \u6B63\u5728\u81EA\u52A8\u5B89\u88C5\u9879\u76EE\u4F9D\u8D56...",S({projectName:t})}))},H=e=>{const{repository:t,projectName:o,functions:n}=e;(0,k.default)(t,o,i=>{i?(console.log(i),r.stop(),console.log(y.default.red("\u62C9\u53D6\u6A21\u677F\u51FA\u73B0\u672A\u77E5\u9519\u8BEF"))):q({projectName:o,functions:n})})},P=[{type:"input",name:"projectName",message:"\u9879\u76EE\u6587\u4EF6\u5939\u540D\u79F0:",validate(e){return e?p.default.existsSync(e)?"\u6587\u4EF6\u5DF2\u5B58\u5728":!0:"\u8BF7\u8F93\u5165\u6587\u4EF6\u540D"}},{type:"list",name:"template",choices:K,message:"\u8BF7\u9009\u62E9\u8981\u62C9\u53D6\u7684\u6A21\u677F"},{type:"checkbox",name:"functions",choices:j,message:"\u8BF7\u9009\u62E9\u9ED8\u8BA4\u5B89\u88C5\u7684\u529F\u80FD"}];h.default.prompt(P).then(e=>{const{template:t,projectName:o,functions:n}=e;r.start(),r.color="green",H({repository:t,projectName:o,functions:n})});
